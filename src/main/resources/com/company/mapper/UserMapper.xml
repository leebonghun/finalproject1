<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.company.mapper.UserMapper">

<!-- 회원 가입 -->
<insert id="insert">
	insert into user_tbl(user_id,user_password,user_confirmPassword,user_name,user_birth,user_email,user_tel,user_regdate)
	values(#{user_id},#{user_password},#{user_password},#{user_name},#{user_birth},#{user_email},#{user_tel},sysdate)
</insert>

<!-- 권한 부여 -->
<insert id="auth">
	insert into auth_tbl(authority, user_id)
	values(#{authority}, #{user_id})
</insert>

<!-- 중복 아이디 검사 -->
<select id="selectById" resultType="com.company.domain.UserDTO">
	select * from user_tbl where user_id=#{user_id}
</select>

<!-- 로그인 -->
<select id="login" resultType="com.company.domain.LoginDTO">
	SELECT USER_ID, USER_PASSWORD FROM USER_TBL WHERE USER_ID=#{USER_ID} AND USER_PASSWORD=#{USER_PASSWORD}
</select>

<resultMap type="com.company.domain.UserDTO" id="memberMap">
		<id property="user_id" column="user_id"/>
		<result property="user_password" column="user_password"/>
		<result property="user_name" column="user_name"/>
		<result property="user_regdate" column="user_regdate"/>
		
		<collection property="authList" resultMap="authMap"/>
		
	</resultMap>
	
	<resultMap type="com.company.domain.AuthDTO" id="authMap">
		<result property="user_id" column="user_id"/>
		<result property="auth" column="authority"/>
	</resultMap>

	<select id="signin" resultMap="memberMap">
		select s1.user_id, user_passwod, user_name, enabled, authority
		from user_tbl s1 left outer join auth_tbl s2 on s1.user_id = s2.user_id
		where s1.user_id = #{user_id}
	</select>

</mapper>

